-- 코드를 입력하세요
SELECT EXTRACT(YEAR FROM SALES_DATE) AS YEAR
,   EXTRACT(MONTH FROM SALES_DATE) AS MONTH
,   COUNT(DISTINCT B.USER_ID) AS PUCHASED_USERS
,   ROUND(COUNT(DISTINCT A.USER_ID) / (SELECT COUNT(*) 
                                         FROM USER_INFO 
                                         WHERE TO_CHAR(JOINED, 'YYYY') = '2021'), 1) AS
PURCHASED_RATIO
             
FROM ONLINE_SALE A
INNER JOIN 
(
    -- 2021년에 회원가입한 회원들만 추출한 테이블
    SELECT USER_ID, JOINED
    FROM USER_INFO  
    WHERE TO_CHAR(JOINED, 'YYYY') = '2021'
)B
 ON A.USER_ID = B.USER_ID
GROUP BY EXTRACT(YEAR FROM SALES_DATE), EXTRACT(MONTH FROM SALES_DATE)
ORDER BY 1, 2